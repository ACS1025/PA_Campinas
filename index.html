<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="src/img/kmd-16x16.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <title>Home - PA-Campinas</title>
    <style>
    /* Estilos principais */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        background-image: url('src/img/Registro\ de\ Saidas.png');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        color: white;
    }

    .container {
        display: flex;
        justify-content: space-between;
        padding: 20px;
        max-width: 1200px;
        margin: auto;
        background-color: transparent;
        border-radius: 10px;
        margin-top: 70px;
    }

    .content {
        flex: 2;
        padding: 20px;
        text-align: center;
    }

    .sidebar {
        width: 200px;
        display: flex;
        flex-direction: column;
    }

    .icon-link {
        margin: 10px 0;
        text-align: center;
        background-color: transparent;
        list-style-type: none;
    }

    .icon-link img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        background-color: transparent;
        margin-bottom: 5px;
        transition: all 0.3s ease;
    }

    .icon-link a {
        display: inline-block;
        text-decoration: none;
        border-radius: 50%;
        padding: 0;
    }

    .icon-link a:hover img {
        background-color: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
        transition: all 0.3s ease;
    }

    .icon-link a.pdf:hover img {
        background-color: rgba(255, 0, 0, 0.3);
    }

    .icon-link p {
        margin: 5px 0 0 0;
        font-size: 12px;
        color: #fff;
    }

    .dashboard-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        flex: 2;
        padding: 20px;
    }

    .dashboard {
        width: 100%;
        max-width: 500px;
        height: 300px;
        border: 1px solid #ddd;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
    }

    .dashboard:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .dashboard-title {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        font-weight: bold;
        background-color: rgba(92, 9, 9, 0.7);
        color: #fff;
        text-align: center;
        z-index: 10;
    }

    .dashboard iframe {
        border: none;
        width: 100%;
        height: calc(100% - 40px);
        flex: 1;
    }

    .dashboard a {
        text-decoration: none;
        color: inherit;
    }

    /* Navbar */
    nav {
        width: 100%;
        background-color: rgba(68, 68, 68, 0.95);
        padding: 15px 0;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    nav ul {
        list-style: none;
        padding: 0;
        text-align: center;
        margin: 0;
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    nav ul li {
        display: inline-block;
    }

    nav ul li a {
        color: rgb(252, 254, 255);
        text-decoration: none;
        font-size: 16px;
        padding: 10px 18px;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }

    nav ul li a:hover {
        background-color: rgba(23, 23, 175, 0.44);
    }

    nav ul li a.active {
        background-color: rgba(23, 23, 175, 0.7);
    }

    .header {
        text-align: center;
        padding: 60px;        
        color: white;
        margin-top: 50px;
    }

    .header h1 {
        margin: 0;
        font-size: 36px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    footer {
        text-align: center;
        padding: 10px;
        background-color: transparent;
        color: grey;
        position: fixed;
        width: 100%;
        bottom: 0;
        margin-top: 20px;
    }

    @media (max-width: 768px) {
        .container {
            flex-direction: column;
        }

        .sidebar {
            width: 100%;
            flex-direction: row;
            overflow-x: auto;
            gap: 10px;
        }

        .icon-link {
            margin: 0 5px;
            flex-shrink: 0;
        }

        .dashboard-container {
            flex-direction: column;
        }

        nav ul {
            flex-direction: column;
            gap: 10px;
        }
    }

    @media (max-width: 480px) {
        .header h1 {
            font-size: 24px;
        }

        nav ul li a {
            font-size: 14px;
            padding: 8px 12px;
        }

        .sidebar {
            width: 100%;
        }

        .dashboard {
            max-width: 100%;
        }
    }
    </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="registro-saidas.html">Registro de Saídas</a></li>
        <li><a href="solicitacao-escolta.html">Solicitação de Escolta</a></li>
        <li><a href="conhecimento.html">Para conhecimento</a></li>
        <li><a href="convite.html">Convite Motorista</a></li>
        <li><a href="videos.html">Galeria de Vídeos</a></li>
        <li><a href="brief.html">Briefing</a></li>
    </ul>
  </nav>

<!-- Cabeçalho com título principal -->
<header class="header">
    <h1>- MONITORAMENTO - <br>PA-Campinas</h1>
</header>

<div class="container">
    <!-- Coluna esquerda -->
    <div class="sidebar">
        <div class="icon-link">
            <a href="https://app.powerbi.com/view?r=eyJrIjoiODRmOTc2NDgtMTA3ZS00ODVmLTk0ZTEtYWU4YTQ1NzY4NjMyIiwidCI6IjRmMjQ2YWRiLTcwMDYtNGE4Yi04YTdiLWQyYjQzNWE2NWFhYSJ9" target="_blank" rel="noopener noreferrer">
                <img src="src/img/KMDPbix.gif" alt="PA Campinas">
            </a>
            <p>PA Campinas</p>
        </div>

        <div class="icon-link">
            <a href="https://app.powerbi.com/view?r=eyJrIjoiODE1Zjc1ZmYtMTg5MS00ODZlLTgwZDAtMmQ1MDAzNzI0MzRkIiwidCI6IjRmMjQ2YWRiLTcwMDYtNGE4Yi04YTdiLWQyYjQzNWE2NWFhYSJ9" target="_blank" rel="noopener noreferrer">
                <img src="src/img/KMDPbix.gif" alt="Coletas">
            </a>
            <p>Coletas SSonic</p>
        </div>

        <div class="icon-link">
            <a href="https://app.powerbi.com/view?r=eyJrIjoiYzAwNzBhM2EtOTBkYS00ZDI2LTg5NjItOTg5Yzc1Njc4ZjA3IiwidCI6IjRmMjQ2YWRiLTcwMDYtNGE4Yi04YTdiLWQyYjQzNWE2NWFhYSJ9" target="_blank" rel="noopener noreferrer">
                <img src="src/img/KMDPbix.gif" alt="Relatorio">
            </a>
            <p>Relatório Mensal</p>
        </div>

        <div class="icon-link">
            <a href="relatorio4.html">
                <img src="src/img/KMDPbix.gif" alt="Relatório 4">
            </a>
            <p>Relatório 4</p>
        </div>

        <div class="icon-link">
            <a href="briefing.html">
                <img src="src/img/KMDPbix.gif" alt="briefing">
            </a>
            <p>Briefing de Viagem</p>
        </div>
    </div>

    <!-- Conteúdo central -->
    <div class="dashboard-container">
        <div class="dashboard powerbi-embed" onclick="toggleFullscreen(this)">
            <div class="dashboard-title">Escoltas em Andamento</div>
            <iframe 
                width="100%" 
                height="100%" 
                src="https://app.powerbi.com/view?r=eyJrIjoiZTg4OTI3ZmYtYzk1Zi00ZGYxLTlmMDctZWI4MmQ1NjkxNTM4IiwidCI6IjRmMjQ2YWRiLTcwMDYtNGE4Yi04YTdiLWQyYjQzNWE2NWFhYSJ9" 
                frameborder="0" 
                allowFullScreen="true">
            </iframe>
        </div>

        <div class="dashboard powerbi-embed" onclick="toggleFullscreen(this)">
            <div class="dashboard-title">Acompanhamento Carreta Solar</div>
            <iframe 
                width="100%" 
                height="100%" 
                src="https://app.powerbi.com/view?r=eyJrIjoiODE1Zjc1ZmYtMTg5MS00ODZlLTgwZDAtMmQ1MDAzNzI0MzRkIiwidCI6IjRmMjQ2YWRiLTcwMDYtNGE4Yi04YTdiLWQyYjQzNWE2NWFhYSJ9" 
                frameborder="0" 
                allowFullScreen="true">
            </iframe>
        </div>
    </div>

    <!-- Coluna direita -->
    <div class="sidebar">
        <div class="icon-link">
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSeEGaGLqegml3MhhjjD_LOrn6SecC0tYEJ9I9wNq8OjACgXww/viewform?embedded=true" target="_blank">
                <img src="src/img/checklist.gif" alt="Checklist presencial">
            </a>
            <p>Checklist presencial</p>
        </div>

        <div class="icon-link">
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSc3SvaWWqrfbBmxj6TdLDr5AbkuF6QD0Fm9kGrwQ0mracRxqw/viewform?embedded=true" target="_blank">
                <img src="src/img/briefing.gif" alt="Briefing digital">
            </a>
            <p>Briefing digital</p>
        </div>

        <div class="icon-link">
            <a href="https://docs.google.com/presentation/d/e/2PACX-1vRA6jDzcE_wYCi9tPomaGZol04jb6UspexRU1P_5cBtywUg4frobdVOWUj0bAr8l-B-F2lx4sF8aTsI/pub?start=false&loop=false&delayms=3000" target="_blank">
                <img src="src/img/treinamento.gif" alt="Treinamento motorista">
            </a>
            <p>Treinamento motorista</p>
        </div>

        <div class="icon-link">
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSdIvZGFCID_1TmfICBGlqWn1AZXAZu-9WIjuBCw3RRxU98F9g/viewform?embedded=true" target="_blank">
                <img src="src/img/dica.gif" alt="Dica">
            </a>
            <p>Dica</p>
        </div>

        <div class="icon-link">
            <a href="src/pdf/Checklist Presencial - Modelo.pdf" target="_blank" class="pdf">
                <img src="src/img/dica.gif" alt="Checklist presencial">
            </a>
            <p>Checklist presencial</p>
        </div>
    </div>
</div>

<footer>
    <p>&copy; 2024 PA-Campinas. Todos os direitos reservados. by ACS</p>
</footer>

<script>
    // Função para alternar tela cheia
    function toggleFullscreen(element) {
        if (!document.fullscreenElement) {
            element.requestFullscreen().catch(err => {
                console.error(`Erro ao entrar em tela cheia: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
    }

  // URL FIXA do seu WebApp
  const endpointBase = "https://script.google.com/macros/s/AKfycbxmPtxbxQHWQP0-o2VAtPrmT6Qta-bpTjUPtLsYnDLSsmmxKuVv-Y2kWSL-WwLSnGri/exec";

  // listas carregadas do WebApp (?list=...)
  let listaNomes = [], listaPlacas = [], listaCarretas = [];

  // carrega listas ao abrir (única vez)
  (async function loadLists(){
    try {
      const r1 = await fetch(endpointBase + '?list=motoristas');
      listaNomes = await r1.json();
    } catch(e){ console.error('Erro ao carregar motoristas:', e); }
    try {
      const r2 = await fetch(endpointBase + '?list=placas');
      listaPlacas = await r2.json();
    } catch(e){ console.error('Erro ao carregar placas:', e); }
    try {
      const r3 = await fetch(endpointBase + '?list=carretas');
      listaCarretas = await r3.json();
    } catch(e){ console.error('Erro ao carregar carretas:', e); }
  })();

  // helpers autocomplete
  function showList(containerId, items) {
    const ul = document.getElementById(containerId);
    if (!ul) return;
    ul.innerHTML = '';
    if(!items || items.length === 0){ ul.style.display = 'none'; return; }
    items.forEach(it => {
      const li = document.createElement('li');
      li.textContent = it;
      li.onclick = () => {
        if(containerId === 'lista-motorista') document.getElementById('motorista').value = it;
        if(containerId === 'lista-placa') document.getElementById('placa_cavalo').value = it;
        if(containerId === 'lista-carreta') document.getElementById('placa_carreta').value = it;
        ul.innerHTML = '';
        ul.style.display = 'none';
      };
      ul.appendChild(li);
    });
    ul.style.display = 'block';
  }

  const motoristaInput = document.getElementById('motorista');
  if (motoristaInput) {
    motoristaInput.addEventListener('input', function(){
      const v = this.value.trim();
      if(!v){ showList('lista-motorista', []); return; }
      const matches = listaNomes.filter(n => n.toLowerCase().startsWith(v.toLowerCase())).slice(0,30);
      showList('lista-motorista', matches);
    });
  }

  const placaCavaloInput = document.getElementById('placa_cavalo');
  if (placaCavaloInput) {
    placaCavaloInput.addEventListener('input', function(){
      const v = this.value.trim();
      if(!v){ showList('lista-placa', []); return; }
      const matches = listaPlacas.filter(p => p.toLowerCase().startsWith(v.toLowerCase())).slice(0,30);
      showList('lista-placa', matches);
    });
  }

  const placaCarretaInput = document.getElementById('placa_carreta');
  if (placaCarretaInput) {
    placaCarretaInput.addEventListener('input', function(){
      const v = this.value.trim();
      if(!v){ showList('lista-carreta', []); return; }
      const matches = listaCarretas.filter(p => p.toLowerCase().startsWith(v.toLowerCase())).slice(0,30);
      showList('lista-carreta', matches);
    });
  }

  // envio
  const btnEnviar = document.getElementById('btnEnviar');
  if (btnEnviar) {
    btnEnviar.addEventListener('click', async function(){
      const btn = this;
      const data = {
        sm: document.getElementById('sm').value.trim(),
        embarcador: document.getElementById('embarcador').value.trim(),
        transportador: document.getElementById('transportador').value.trim(),
        equipamento: document.getElementById('equipamento').value.trim(),
        motorista: document.getElementById('motorista').value.trim(),
        placa_cavalo: document.getElementById('placa_cavalo').value.trim(),
        placa_carreta: document.getElementById('placa_carreta').value.trim(),
        rota: document.getElementById('rota').value.trim(),
        cliente: document.getElementById('cliente').value.trim()
      };

      // validações mínimas
      if(!data.sm){ alert('Preencha o Código SM.'); return; }
      if(!data.motorista){ if(!confirm('Motorista vazio. Deseja continuar?')) return; }

      btn.disabled = true;
      const params = new URLSearchParams(data).toString();

      try {
        const res = await fetch(endpointBase, {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: params
        });
        const json = await res.json();
        if(json.ok){
          document.getElementById('resultado').innerHTML =
            '<div class="link">Link gerado: <a href="'+json.link+'" target="_blank">'+json.link+'</a></div>' +
            '<div style="margin-top:12px;color:#fff">Enviar por WhatsApp: <a target="_blank" href="https://wa.me/?text='+encodeURIComponent('Olá, '+ (data.motorista||'') +'. Confira seu briefing: '+json.link)+'">Enviar WhatsApp</a></div>';
        } else {
          document.getElementById('resultado').innerText = 'Erro: ' + (json.error || JSON.stringify(json));
        }
      } catch (err){
        console.error('Erro:', err);
        document.getElementById('resultado').innerText = 'Erro no envio: ' + (err.message || err);
      } finally {
        btn.disabled = false;
      }
    });
  }
</script>

</body>
</html>